function parseLinks(){$("a").each(function(){if($(this).attr("href").indexOf("://")>=0){$(this).attr("target","_blank")}})}function scrollTo(a){$("html, body").animate({scrollTop:a.offset().top},{duration:"slow",easing:"swing"})}var MIN_WIDTH=10;var MIN_HEIGHT=10;var MAX_WIDTH=1e3;var MAX_HEIGHT=1e3;var DEFAULT_PATTERN_PERIOD=2800;var Loading=new Image(16,16);Image.src="Images/Loading.gif";var PREVIEW_GENERATION_STEPS=["Resizing image","Optimizing color palette","Finding best thread colors","Generating preview image","Building thread table","Finishing up"];var PATTERN_GENERATION_STEPS=["Analyzing image","Determining page count","Devising symbols","Drawing pattern grid","Building thread table","Finishing up"];$(document).ready(function(){var a=new StepCounter($("div#PreviewStepWrapper"),PREVIEW_GENERATION_STEPS);var b=new StepCounter($("div#PatternStepWrapper"),PATTERN_GENERATION_STEPS);$("div#Colors").slider({min:1,max:100,value:50});$("div#PreviewButton").click(function(){if($(this).hasClass("Disabled")){return false}var b=$(this).addClass("Disabled");var c=$("input#ImagePath").val();var d=parseInt($("input#Width").val());var e=parseInt($("input#Height").val());var f=parseInt($("div#Colors").slider("option","value"));$("div#PreviewStep, div#GenerateStep").slideUp();$("div#Status").slideUp();var g=[];if(isNaN(d)){g.push("Please enter a width.")}else if(d<MIN_WIDTH){g.push("Please enter a width of at least "+String(MIN_WIDTH)+".")}else if(d>MAX_WIDTH){g.push("Images are limited to "+String(MAX_WIDTH)+" stitches wide. Please use a narrower size.")}if(isNaN(e)){g.push("Please enter a height.")}else if(e<MIN_HEIGHT){g.push("Please enter a height of at least "+String(MIN_HEIGHT)+".")}else if(e>MAX_HEIGHT){g.push("Images are limited to "+String(MAX_HEIGHT)+" stitches wide. Please use a shorter size.")}if(g.length){$("div#Status").addClass("Error").html(g.join("<br />")).slideDown();scrollTo($("div#Status"));b.removeClass("Disabled");return}b.html("<img src='Images/Loading.gif' />");a.setPeriod(Math.ceil(.5*e*d/PREVIEW_GENERATION_STEPS.length));a.start();$.ajax({type:"post",dataType:"json",url:"AJAX/GeneratePreview.ajax.php",data:{WebLink:c,Width:d,Height:e,Colors:f},success:function(c){b.text("Make Preview").removeClass("Disabled");a.clear();if(c.Success){$("div#Status").removeClass("Error").html("").slideUp();$("div#Preview").html(c.Preview);$("div#Table").html(c.Table);$("div#PreviewStep, div#GenerateStep").slideDown();scrollTo($("div#PreviewStep"))}else{scrollTo($("div#Status"));$("div#Status").addClass("Error").html(c.Message).slideDown()}}})});$("div#PatternButton").click(function(){if($(this).hasClass("Disabled")){return false}var a=$(this).addClass("Disabled");var c=$("input#ImagePath").val();var d=parseInt($("input#Width").val());var e=parseInt($("input#Height").val());var f=parseInt($("div#Colors").slider("option","value"));$("div#Status").slideUp();var g=[];if(isNaN(d)){g.push("Please enter a width.")}else if(d<MIN_WIDTH){g.push("Please enter a width of at least "+String(MIN_WIDTH)+".")}else if(d>MAX_WIDTH){g.push("Images are limited to "+String(MAX_WIDTH)+" stitches wide. Please use a narrower size.")}if(isNaN(e)){g.push("Please enter a height.")}else if(e<MIN_HEIGHT){g.push("Please enter a height of at least "+String(MIN_HEIGHT)+".")}else if(e>MAX_HEIGHT){g.push("Images are limited to "+String(MAX_HEIGHT)+" stitches wide. Please use a shorter size.")}if(g.length){$("div#Status").addClass("Error").html(g.join("<br />")).slideDown();scrollTo($("div#Status"));a.removeClass("Disabled");return}a.html("<img src='Images/Loading.gif' />");$("div#ChoosePictureStep, div#SetLimitsStep, div#MakePreviewStep").slideUp();b.setPeriod(DEFAULT_PATTERN_PERIOD);b.start();$.ajax({type:"post",dataType:"json",url:"AJAX/GeneratePattern.ajax.php",data:{WebLink:c,Width:d,Height:e,Colors:f},success:function(c){a.text("Make Pattern").removeClass("Disabled");b.clear();if(c.Success){$("div#Status").removeClass("Error").html(c.Message).slideDown();parseLinks()}else{$("div#Status").addClass("Error").html(c.Message).slideDown()}scrollTo($("div#Status"))}})})})